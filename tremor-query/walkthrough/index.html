
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="The Tremor Team">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.5">
    
    
      
        <title>Walkthrough - Tremor Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#trickle-walkthough" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Tremor Documentation" class="md-header__button md-logo" aria-label="Tremor Documentation" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tremor Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Walkthrough
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/tremor-rs/tremor-www-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tremor-rs/tremor-www-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Tremor Documentation" class="md-nav__button md-logo" aria-label="Tremor Documentation" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    Tremor Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/tremor-rs/tremor-www-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tremor-rs/tremor-www-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        Architecture Overview
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Tremor Query
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tremor Query" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tremor Query
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../operators/" class="md-nav__link">
        Operators
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../modules/" class="md-nav__link">
        Modules
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pp/" class="md-nav__link">
        Lexical Preprocessor
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Walkthrough
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Walkthrough
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scripts-and-operators" class="md-nav__link">
    Scripts and Operators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-query-graph-algorithms" class="md-nav__link">
    Building Query Graph Algorithms
  </a>
  
    <nav class="md-nav" aria-label="Building Query Graph Algorithms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#branching" class="md-nav__link">
    Branching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#combining" class="md-nav__link">
    Combining
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregations" class="md-nav__link">
    Aggregations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation-mechanics" class="md-nav__link">
    Aggregation Mechanics
  </a>
  
    <nav class="md-nav" aria-label="Aggregation Mechanics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windowing" class="md-nav__link">
    Windowing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tilt-frames" class="md-nav__link">
    Tilt Frames
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group-mechanics" class="md-nav__link">
    Group Mechanics
  </a>
  
    <nav class="md-nav" aria-label="Group Mechanics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-based-grouping" class="md-nav__link">
    Set based grouping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#each-based-grouping" class="md-nav__link">
    Each based grouping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      <label class="md-nav__link" for="__nav_3_6">
        Aggregate Function Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Aggregate Function Reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Aggregate Function Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../functions/stats/" class="md-nav__link">
        stats
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../functions/win/" class="md-nav__link">
        win
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../recipes/" class="md-nav__link">
        Recipes
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Tremor Script
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tremor Script" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tremor Script
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/modules/" class="md-nav__link">
        Modules
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/pp/" class="md-nav__link">
        Lexical Preprocessor
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      <label class="md-nav__link" for="__nav_4_4">
        Function Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Function Reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Function Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/functions/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/" class="md-nav__link">
        cncf
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/tremor/" class="md-nav__link">
        tremor
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/" class="md-nav__link">
        std
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/tremor/origin/" class="md-nav__link">
        tremor::origin
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/tremor/chash/" class="md-nav__link">
        tremor::chash
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/tremor/system/" class="md-nav__link">
        tremor::system
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/" class="md-nav__link">
        cncf::otel
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/trace/" class="md-nav__link">
        cncf::otel::trace
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/metrics/" class="md-nav__link">
        cncf::otel::metrics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/trace_id/" class="md-nav__link">
        cncf::otel::trace_id
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/logs/" class="md-nav__link">
        cncf::otel::logs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/span_id/" class="md-nav__link">
        cncf::otel::span_id
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/trace/status/" class="md-nav__link">
        cncf::otel::trace::status
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/trace/spankind/" class="md-nav__link">
        cncf::otel::trace::spankind
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/metrics/temporality/" class="md-nav__link">
        cncf::otel::metrics::temporality
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/logs/severity/" class="md-nav__link">
        cncf::otel::logs::severity
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/cncf/otel/logs/traceflags/" class="md-nav__link">
        cncf::otel::logs::traceflags
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/re/" class="md-nav__link">
        std::re
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/base64/" class="md-nav__link">
        std::base64
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/record/" class="md-nav__link">
        std::record
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/test/" class="md-nav__link">
        std::test
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/math/" class="md-nav__link">
        std::math
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/float/" class="md-nav__link">
        std::float
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/array/" class="md-nav__link">
        std::array
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/string/" class="md-nav__link">
        std::string
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/json/" class="md-nav__link">
        std::json
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/type/" class="md-nav__link">
        std::type
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/binary/" class="md-nav__link">
        std::binary
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/url/" class="md-nav__link">
        std::url
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/range/" class="md-nav__link">
        std::range
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/random/" class="md-nav__link">
        std::random
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/stdlib/std/integer/" class="md-nav__link">
        std::integer
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" type="checkbox" id="__nav_4_5" >
      
      <label class="md-nav__link" for="__nav_4_5">
        Extractor Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Extractor Reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Extractor Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/base64/" class="md-nav__link">
        Base64
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/cidr/" class="md-nav__link">
        CIDR
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/datetime/" class="md-nav__link">
        Datetime
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/dissect/" class="md-nav__link">
        Dissect
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/glob/" class="md-nav__link">
        Glob
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/grok/" class="md-nav__link">
        Grok
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/influx/" class="md-nav__link">
        Influx
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/json/" class="md-nav__link">
        JSON
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/kv/" class="md-nav__link">
        KV
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/extractors/regex/" class="md-nav__link">
        Regex
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tremor-script/recipes/" class="md-nav__link">
        Recipes
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Operations
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Operations" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Operations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/monitoring/" class="md-nav__link">
        Monitoring
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/cli/" class="md-nav__link">
        Tremor Tool
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/configuration-walkthrough/" class="md-nav__link">
        Configuration Walkthrough
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/gdcb/" class="md-nav__link">
        Circuit Breakers and Guaranteed Delivery
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/linked-transports/" class="md-nav__link">
        Linked Transports
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Artefacts
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Artefacts" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Artefacts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../artefacts/preprocessors/" class="md-nav__link">
        Preprocessors
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../artefacts/postprocessors/" class="md-nav__link">
        Postprocessors
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../artefacts/codecs/" class="md-nav__link">
        Codecs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../artefacts/onramps/" class="md-nav__link">
        Onramps
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../artefacts/offramps/" class="md-nav__link">
        Offramps
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../history/" class="md-nav__link">
        History
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      <label class="md-nav__link" for="__nav_10">
        Workshops
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Workshops" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Workshops
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_1" type="checkbox" id="__nav_10_1" >
      
      <label class="md-nav__link" for="__nav_10_1">
        Basic examples
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Basic examples" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_1">
          <span class="md-nav__icon md-icon"></span>
          Basic examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/00_passthrough/" class="md-nav__link">
        Passthrough
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/01_filter/" class="md-nav__link">
        Filter
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/02_transform/" class="md-nav__link">
        Transform
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/03_validate/" class="md-nav__link">
        Validate
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_2" type="checkbox" id="__nav_10_2" >
      
      <label class="md-nav__link" for="__nav_10_2">
        Integrations
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Integrations" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_2">
          <span class="md-nav__icon md-icon"></span>
          Integrations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/10_logstash/" class="md-nav__link">
        Logstash
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/11_influx/" class="md-nav__link">
        Influx
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/12_postgres_timescaledb/" class="md-nav__link">
        Timescale
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/13_grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_3" type="checkbox" id="__nav_10_3" >
      
      <label class="md-nav__link" for="__nav_10_3">
        Delivery Guarantees
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Delivery Guarantees" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_3">
          <span class="md-nav__icon md-icon"></span>
          Delivery Guarantees
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/20_transient_gd/" class="md-nav__link">
        Transient GD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/21_persistent_gd/" class="md-nav__link">
        Persistent GD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/22_roundrobin/" class="md-nav__link">
        Round Robin
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/23_kafka_gd/" class="md-nav__link">
        Kafka
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_4" type="checkbox" id="__nav_10_4" >
      
      <label class="md-nav__link" for="__nav_10_4">
        Linked Ramps
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Linked Ramps" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_4">
          <span class="md-nav__icon md-icon"></span>
          Linked Ramps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/30_servers_lt_http/" class="md-nav__link">
        HTTP Server
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/31_servers_lt_ws/" class="md-nav__link">
        Websocket Server
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/32_proxies_lt_http/" class="md-nav__link">
        HTTP Proxy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/33_proxies_lt_ws/" class="md-nav__link">
        Websocket Proxy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/34_bridges_lt_http_ws/" class="md-nav__link">
        HTTP -> WS Bridge
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/35_reverse_proxy_load_balancing/" class="md-nav__link">
        HTTP Load Balancing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/36_quota_service/" class="md-nav__link">
        Quota Service
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/37_configurator/" class="md-nav__link">
        Configurator
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/38_polling_alerts/" class="md-nav__link">
        Polling and Alerting
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/39_kafka_elastic_correlation/" class="md-nav__link">
        Event Correlation from Kafka to Elasticsearch
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_5" type="checkbox" id="__nav_10_5" >
      
      <label class="md-nav__link" for="__nav_10_5">
        CNCF
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="CNCF" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_5">
          <span class="md-nav__icon md-icon"></span>
          CNCF
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/40_otel_passthrough/" class="md-nav__link">
        OpenTelemetry Passthrough
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/41_otel_zipkin/" class="md-nav__link">
        Zipkin Interworking
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/42_otel_jaeger/" class="md-nav__link">
        Jaeger Interworking
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/43_otel_prometheus/" class="md-nav__link">
        Prometheus Interworking
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../workshop/examples/44_otel_elastic_apm/" class="md-nav__link">
        Elastic APM Interworking
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      <label class="md-nav__link" for="__nav_11">
        Development
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../development/quick-start/" class="md-nav__link">
        Quick Start Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../development/profiling/" class="md-nav__link">
        Profiling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../development/debugging/" class="md-nav__link">
        Debugging with LLDB
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11_4" type="checkbox" id="__nav_11_4" >
      
      <label class="md-nav__link" for="__nav_11_4">
        Benchmarking
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Benchmarking" data-md-level="2">
        <label class="md-nav__title" for="__nav_11_4">
          <span class="md-nav__icon md-icon"></span>
          Benchmarking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../development/benchmarking/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../development/benchmarks/LogstashBenchmark/" class="md-nav__link">
        Logstash
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../development/testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../development/issue-investigation/" class="md-nav__link">
        Investigation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        Governance
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Governance" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Governance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../CodeOfConduct/" class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../CII/" class="md-nav__link">
        Core Infrastructure Initiative
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/security/" class="md-nav__link">
        Security
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scripts-and-operators" class="md-nav__link">
    Scripts and Operators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-query-graph-algorithms" class="md-nav__link">
    Building Query Graph Algorithms
  </a>
  
    <nav class="md-nav" aria-label="Building Query Graph Algorithms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#branching" class="md-nav__link">
    Branching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#combining" class="md-nav__link">
    Combining
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregations" class="md-nav__link">
    Aggregations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation-mechanics" class="md-nav__link">
    Aggregation Mechanics
  </a>
  
    <nav class="md-nav" aria-label="Aggregation Mechanics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windowing" class="md-nav__link">
    Windowing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tilt-frames" class="md-nav__link">
    Tilt Frames
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group-mechanics" class="md-nav__link">
    Group Mechanics
  </a>
  
    <nav class="md-nav" aria-label="Group Mechanics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-based-grouping" class="md-nav__link">
    Set based grouping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#each-based-grouping" class="md-nav__link">
    Each based grouping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    Limitations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/tremor-rs/tremor-www-docs/edit/main/docs/tremor-query/walkthrough.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="trickle-walkthough">Trickle Walkthough<a class="headerlink" href="#trickle-walkthough" title="Permanent link">&para;</a></h1>
<hr />
<p>In this section we walk through increasingly complex tremor query language ( trickle )
programming examples, introducing key concepts as we progress.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Trickle is a near real-time stream-based structured query language that
builds on the tremor scripting language.</p>
<p>Trickle queries are compiled in pipeline DAGs and replace the yaml pipeline
format used in previous versions to describe event processing graphs in
the tremor runtime.</p>
<p>The most basic query possible in trickle is</p>
<div class="highlight"><pre><span></span><code><span class="kd">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="kd">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="kd">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"> </span><span class="c1"># A basic passthrough query pipeline</span>
</code></pre></div>
<p>The <code>event</code> keyword selects the event from the standard input stream <code>in</code>
and passes it through unchanged to the standard output stream <code>out</code>.</p>
<p>In tremor's trickle query language queries are compiled and optimised and
data is streamed though the query. Data can be passed through, transformed,
filtered, aggregated, branched or combined to form continuous stream processing
algorithms.</p>
<p>Like other event processing languages, trickle <em>inverts</em> the relationship between
query and data when compared to normal RDBMS SQL languages. Instead of running a
dynamic query against static in memory or disk persisted data, we compile and
optimise queries and stream near real-time data through each query.</p>
<p>Data can be ingested from the outside world via the 'in' standard stream.
Data can be produced to the outside world via the 'out' standard stream.
Errors can be processed through the 'err' standard stream.</p>
<p>These three primitives are analogous to the <code>stdin</code>, <code>stdout</code> and <code>stderr</code> streams
in UNIX-like systems. These can be chained or interconnected via connecting multiple
statements together to form a directed acyclic graph.</p>
<p>We can branch inputs using <code>where</code> and <code>having</code> clauses as filters to logically
partition streams into independent processing streams.</p>
<p>In the below example we partition events by their <code>seq_num</code> field. If the number
is even, we branch the corresponding events into a stream named <code>evens</code>. If the
number is odd, we branch to a stream named <code>odds</code>.</p>
<p>The logical inverse of branching is to unify or union streams together, this operation
is also supported via the select operation and is demonstrated below. We combine
the <code>evens</code> and <code>odds</code> streams into the standard output stream</p>
<div class="highlight"><pre><span></span><code><span class="c1"># create private intermediate internal streams</span>
<span class="kd">create</span><span class="w"> </span><span class="kd">stream</span><span class="w"> </span><span class="nx">evens</span><span class="err">;</span><span class="w"></span>
<span class="kd">create</span><span class="w"> </span><span class="kd">stream</span><span class="w"> </span><span class="nx">odds</span><span class="err">;</span><span class="w"></span>

<span class="c1"># branch input into even/odd sequenced events using where clause</span>
<span class="kd">select</span><span class="w"> </span><span class="nx">{</span><span class="w"> </span><span class="s">&quot;even&quot;</span><span class="err">:</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">}</span><span class="w"> </span><span class="kd">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="kd">where</span><span class="w"> </span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">seq_num</span><span class="w"> </span><span class="err">%</span><span class="mi">2</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="mi">1</span><span class="err">)</span><span class="w"> </span><span class="kd">into</span><span class="w"> </span><span class="nx">evens</span><span class="err">;</span><span class="w"></span>
<span class="kd">select</span><span class="w"> </span><span class="nx">{</span><span class="w"> </span><span class="s">&quot;odd&quot;</span><span class="err">:</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">}</span><span class="w"> </span><span class="kd">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="kd">where</span><span class="w"> </span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">seq_num</span><span class="w"> </span><span class="err">%</span><span class="mi">2</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="mi">0</span><span class="err">)</span><span class="w"> </span><span class="kd">into</span><span class="w"> </span><span class="nx">odds</span><span class="err">;</span><span class="w"></span>

<span class="c1"># combine / union evens and odds into standard out stream</span>
<span class="kd">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="kd">from</span><span class="w"> </span><span class="nx">evens</span><span class="w"> </span><span class="kd">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
<span class="kd">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="kd">from</span><span class="w"> </span><span class="nx">odds</span><span class="w"> </span><span class="kd">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>We can test this with a json event using the <code>tremor</code> command line tool</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span> <span class="nt">&quot;seq_num&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nt">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;horse&quot;</span> <span class="p">}</span>
</code></pre></div>
<p>Assuming the trickle query is stored in a file called <code>evenodd.trickle</code> with the sample event
in a file called <code>data.json</code></p>
<div class="highlight"><pre><span></span><code>$ tremor run evenodd.trickle -i data.json
</code></pre></div>
<p>The command line tool will inject all events from the file provided by the <code>-i</code> argument and we would
expect to see output from the tool as follows:</p>
<div class="highlight"><pre><span></span><code><span class="o">{</span><span class="s2">&quot;odd&quot;</span>: <span class="o">{</span><span class="s2">&quot;seq_num&quot;</span>: <span class="m">4</span>, <span class="s2">&quot;value&quot;</span>: <span class="m">10</span>, <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;horse&quot;</span><span class="o">}}</span>
</code></pre></div>
<h2 id="scripts-and-operators">Scripts and Operators<a class="headerlink" href="#scripts-and-operators" title="Permanent link">&para;</a></h2>
<p>Here's the logic for an entire backpressure algorithm that could be introduced as
a proxy between two systems, implemented by using a builtin operator called <a href="../operators/#qosbackpressure"><code>qos::backpressure</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">define</span><span class="w"> </span><span class="nx">qos</span><span class="err">::</span><span class="nx">backpressure</span><span class="w"> </span><span class="kd">operator</span><span class="w"> </span><span class="nx">bp</span><span class="w"></span>
<span class="kd">with</span><span class="w"></span>
<span class="w">    </span><span class="nx">timeout</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">10000</span><span class="err">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">steps</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">[</span><span class="w"> </span><span class="mi">1</span><span class="err">,</span><span class="w"> </span><span class="mi">50</span><span class="err">,</span><span class="w"> </span><span class="mi">100</span><span class="err">,</span><span class="w"> </span><span class="mi">250</span><span class="err">,</span><span class="w"> </span><span class="mi">750</span><span class="w"> </span><span class="err">],</span><span class="w"></span>
<span class="kd">end</span><span class="err">;</span><span class="w"></span>

<span class="kd">create</span><span class="w"> </span><span class="kd">operator</span><span class="w"> </span><span class="nx">bp</span><span class="w"> </span><span class="kd">from</span><span class="w"> </span><span class="nx">bp</span><span class="err">;</span><span class="w"></span>
<span class="kd">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="kd">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="kd">into</span><span class="w"> </span><span class="nx">bp</span><span class="err">;</span><span class="w"></span>
<span class="kd">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="kd">from</span><span class="w"> </span><span class="nx">bp</span><span class="w"> </span><span class="kd">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>A slightly more complex example that uses both operators and the tremor scripting language
with the query language all together:</p>
<div class="highlight"><pre><span></span><code><span class="nx">define</span><span class="w"> </span><span class="nx">grouper</span><span class="err">::</span><span class="nx">bucket</span><span class="w"> </span><span class="nx">operator</span><span class="w"> </span><span class="nx">kfc</span><span class="err">;</span><span class="w"></span>

<span class="nx">define</span><span class="w"> </span><span class="nx">script</span><span class="w"> </span><span class="nx">categorize</span><span class="w"></span>
<span class="nx">script</span><span class="w"></span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="err">$</span><span class="nx">rate</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">1</span><span class="err">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="err">$</span><span class="nx">class</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="kc">event</span><span class="err">.`</span><span class="nx">group</span><span class="err">`;</span><span class="w"></span>
<span class="w">  </span><span class="nx">{</span><span class="w"> </span><span class="s">&quot;event&quot;</span><span class="err">:</span><span class="w"> </span><span class="kc">event</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;rate&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">$</span><span class="nx">rate</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;class&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">$</span><span class="nx">class</span><span class="w"> </span><span class="nx">}</span><span class="err">;</span><span class="w"></span>
<span class="kd">end</span><span class="err">;</span><span class="w"></span>

<span class="nx">create</span><span class="w"> </span><span class="nx">operator</span><span class="w"> </span><span class="nx">kfc</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">kfc</span><span class="err">;</span><span class="w"></span>

<span class="c1"># where script definition and instance name are the same, we can</span>
<span class="c1"># omit the from clause in operator and script &#39;create&#39; statements</span>
<span class="nx">create</span><span class="w"> </span><span class="nx">script</span><span class="w"> </span><span class="nx">categorize</span><span class="err">;</span><span class="w"></span>

<span class="c1"># Stream ingested data into categorize script</span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">categorize</span><span class="err">;</span><span class="w"></span>

<span class="c1"># Stream scripted events into kfc bucket operator</span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">categorize</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">kfc</span><span class="err">;</span><span class="w"></span>

<span class="c1"># Stream bucketed events into out stream</span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">kfc</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>Operators are defined as <code>&lt;module&gt;::&lt;name&gt;</code> in the
context of an operator definition clause. Operators, like script definitions can take arguments.</p>
<p>Definitions in tremor are non-executing. They should be considered as templates or specifications.</p>
<p>In the query language, any <code>define</code> clause creates specifications, possibly with arguments for
specialization. They are typically incarnated via the <code>create</code> clause. Anything that is <code>create</code>ed
will form a stream or node in the query graph - these <em>do</em> consume memory and participate in a
pipeline query algorithm.</p>
<p>So in the above example, the <code>categorize</code> script and the <code>categorize</code> node have both a definition
or specification <strong>and</strong> an instance node that participates in the graph at runtime. It is often
convenient to use the same name where there is only one instance of an operator of a given type.</p>
<h2 id="building-query-graph-algorithms">Building Query Graph Algorithms<a class="headerlink" href="#building-query-graph-algorithms" title="Permanent link">&para;</a></h2>
<p>Data streams can be branched and combined in the trickle query language via
the select statement. The resulting graphs must be acyclic with no direct or
indirect looping cycles.</p>
<h3 id="branching">Branching<a class="headerlink" href="#branching" title="Permanent link">&para;</a></h3>
<p>Branching data streams to multiple streams is performed via select operations</p>
<p>Branch data into 3 different output stream ports</p>
<div class="highlight"><pre><span></span><code><span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">/</span><span class="nx">a</span><span class="err">;</span><span class="w"></span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">/</span><span class="nx">b</span><span class="err">;</span><span class="w"></span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">/</span><span class="nx">c</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>Branch data into 3 different intermediate streams</p>
<div class="highlight"><pre><span></span><code><span class="nx">create</span><span class="w"> </span><span class="nx">stream</span><span class="w"> </span><span class="nx">a</span><span class="err">;</span><span class="w"></span>
<span class="nx">create</span><span class="w"> </span><span class="nx">stream</span><span class="w"> </span><span class="nx">b</span><span class="err">;</span><span class="w"></span>
<span class="nx">create</span><span class="w"> </span><span class="nx">stream</span><span class="w"> </span><span class="nx">c</span><span class="err">;</span><span class="w"></span>

<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">a</span><span class="err">;</span><span class="w"></span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">b</span><span class="err">;</span><span class="w"></span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">c</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<h2 id="combining">Combining<a class="headerlink" href="#combining" title="Permanent link">&para;</a></h2>
<p>Multiple data streams can also be combined via select operations.</p>
<p>Combine 3 data streams into a single output stream</p>
<div class="highlight"><pre><span></span><code><span class="err">...</span><span class="w"></span>

<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>Combine 3 data stream ports from 1 or many streams into a single output stream</p>
<div class="highlight"><pre><span></span><code><span class="err">...</span><span class="w"></span>

<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">a</span><span class="err">/</span><span class="mi">1</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">a</span><span class="err">/</span><span class="mi">2</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
<span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<h2 id="aggregations">Aggregations<a class="headerlink" href="#aggregations" title="Permanent link">&para;</a></h2>
<p>A key feature of the tremor query language are aggregations. These are supported with:</p>
<ul>
<li>Windows - A window is a range of events, clock or data time. There can be many different types of windows.</li>
<li>Aggregate functions - An aggregate function is a function that runs in the context of a window of events, emitting results intermittently</li>
<li>Tilt Frames - A tilt frame is a chain of compatible windows with <strong>decreasing</strong> resolution used to reduce memory pressure and preserve relative accuracy of windowed aggregate functions</li>
</ul>
<p>An example clock-driven tumbling window:</p>
<div class="highlight"><pre><span></span><code>define tumbling window `15secs`
with
   interval = core::datetime::with_seconds(15),
end;

select {
    &quot;count&quot;: aggr::stats::count(), # Aggregate &#39;count&#39; function
    &quot;min&quot;: aggr::stats::min(event.value),
    &quot;max&quot;: aggr::stats::max(event.value),
    &quot;mean&quot;: aggr::stats::mean(event.value),
    &quot;stdev&quot;: aggr::stats::stdev(event.value),
    &quot;var&quot;: aggr::stats::var(event.value),
}
from in[`15secs`] # We apply the window nominally to streams
into out;
</code></pre></div>
<p>To use a window we need to define the window specifications, such as a 15 second clock-based
tumbling window called <code>15secs</code> as above. We can then create instances of these windows at runtime by
applying those windows to streams. This is done in the <code>from</code> clause of a <code>select</code> statement.</p>
<p>Wherever windows are applied, aggregate functions can be used. In the above example, we are calculating
the minimum, maximum, average, standard deviation and variance of a <code>value</code> numeric field in data streaming
into the query via the standard input stream.</p>
<p>The query language is not constrained to clock-driven window definitions. Windows can also be
data-driven or fully programmatic.</p>
<p>A more complete example:</p>
<div class="highlight"><pre><span></span><code><span class="nx">select</span><span class="w"> </span><span class="nx">{</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;measurement&quot;</span><span class="err">:</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">measurement</span><span class="err">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;tags&quot;</span><span class="err">:</span><span class="w"> </span><span class="kd">patch</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">tags</span><span class="w"> </span><span class="kd">of</span><span class="w"> </span><span class="kd">insert</span><span class="w"> </span><span class="s">&quot;window&quot;</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="nx">window</span><span class="w"> </span><span class="kd">end</span><span class="err">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;stats&quot;</span><span class="err">:</span><span class="w"> </span><span class="nx">aggr</span><span class="err">::</span><span class="nx">stats</span><span class="err">::</span><span class="nx">hdr</span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">fields</span><span class="err">[</span><span class="nx">group</span><span class="err">[</span><span class="mi">2</span><span class="err">]],</span><span class="w"> </span><span class="err">[</span><span class="w"> </span><span class="s">&quot;0.5&quot;</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;0.9&quot;</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;0.99&quot;</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;0.999&quot;</span><span class="w"> </span><span class="err">]),</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;class&quot;</span><span class="err">:</span><span class="w"> </span><span class="nx">group</span><span class="err">[</span><span class="mi">2</span><span class="err">],</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;timestamp&quot;</span><span class="err">:</span><span class="w"> </span><span class="nx">aggr</span><span class="err">::</span><span class="nx">win</span><span class="err">::</span><span class="nx">first</span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">timestamp</span><span class="err">),</span><span class="w"></span>
<span class="nx">}</span><span class="w"></span>
<span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="err">[`</span><span class="mi">10</span><span class="nx">secs</span><span class="err">`,</span><span class="w"> </span><span class="err">`</span><span class="mi">1</span><span class="nx">min</span><span class="err">`,</span><span class="w"> </span><span class="err">`</span><span class="mi">10</span><span class="nx">min</span><span class="err">`,</span><span class="w"> </span><span class="err">`</span><span class="mi">1</span><span class="nx">h</span><span class="err">`]</span><span class="w"></span>
<span class="nx">where</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">measurement</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="s">&quot;udp_lb_test&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kc">or</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">measurement</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="s">&quot;kafka-proxy.endpoints&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kc">or</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">measurement</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="s">&quot;burrow_group&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kc">or</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">measurement</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="s">&quot;burrow_partition&quot;</span><span class="w"></span>
<span class="w">   </span><span class="kc">or</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">measurement</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="s">&quot;burrow_topic&quot;</span><span class="w"></span>
<span class="nx">group</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">set</span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">measurement</span><span class="err">,</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">tags</span><span class="err">,</span><span class="w"> </span><span class="nx">each</span><span class="err">(</span><span class="nx">record</span><span class="err">::</span><span class="nx">keys</span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">fields</span><span class="err">)))</span><span class="w"></span>
<span class="nx">into</span><span class="w"> </span><span class="nx">normalize</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>In the above example we use a single aggregate function called <code>aggr::stats::hdr</code> which uses a high dynamic range
or HDR Histogram to compute quantile estimates and basic statistics against a number of dynamic grouping fields
set by the <code>group</code> clause. A group clause effectively partitions our operation by the group expressions provided
by the trickle query programmer. In the example, we're using the field names of the nested 'fields' record on inbound
events to compose a component of a group that is also qualified by tags and a measurement name. The field component
is used as a numeric input to the histogram aggregate function.</p>
<p>In the <code>from</code> clause, we are using a tilt frame, or a succession of window resolutions over which this aggregate
function is producing results. So a <code>10secs</code> window is emitting on a 10-second repeating basis into a <code>1min</code> frame.
So 6 times per second the state of the 10 second window is merged into the <code>1min</code> frame. This merge process is
performed for each frame in the tilt frame.</p>
<p>The advantage of tilt-frames is that as the target expression is <strong>the same</strong> for each frame, we can <em>merge</em> across
each frame without amplifying error - in short, we get the <strong>effect</strong> of summarisation without loss of accuracy.</p>
<h2 id="aggregation-mechanics">Aggregation Mechanics<a class="headerlink" href="#aggregation-mechanics" title="Permanent link">&para;</a></h2>
<p>The mechanics of aggregation in the query language are non-trivial.</p>
<p>A high level non-normative summary follows.</p>
<h3 id="windowing">Windowing<a class="headerlink" href="#windowing" title="Permanent link">&para;</a></h3>
<p>Assuming a periodic event delivered every 2 seconds into tremor.</p>
<p><img alt="tumbling-event-windows.png" src="../tumbling-event-windows.png" /></p>
<p>A size based window of size 2 would emit a synthetic output event every 2 events.
So the lifespan of a size based window is 2 events, repeated and non-overlapping for tumbling style windows.
In the illustration above events <code>1</code> and <code>2</code> in the first window <code>w0</code> produce a single synthetic or derivate event <code>a</code>
Events <code>3</code> and <code>4</code> in the second window <code>w1</code> produce a single synthetic or derivate event <code>b</code>
As there is no 6th event in the example illustration, we will <em>never</em> get another synthetic output event</p>
<p>Contrast this with the 10 second or clock-based tumbling window. In the first window <code>w0</code>s lifetime we capture
all events in the illustration.</p>
<h3 id="tilt-frames">Tilt Frames<a class="headerlink" href="#tilt-frames" title="Permanent link">&para;</a></h3>
<p>Assuming a continuous flow of events into tremor...</p>
<p><img alt="tilt-frame-mechanics.png" src="../tilt-frame-mechanics.png" /></p>
<p>All the synthetic outputs of successive 5 minute windows that fit into a 15 minute interval are <strong>merged</strong>
into the 15 minute window. All the outputs of successive 15 minute intervals that fit into a 1 hour interval
are <strong>merged</strong> into the 1 hour window. By chaining and merging, tremor can optimise ( reduce ) the amount
of memory required across the chain when compared to multiple independent windows <code>select</code> expressions.
In the case of aggregate functions like <code>aggr::stats::hdr`` or</code>aggr::stats::dds``` the savings are significant.</p>
<p>If we imagine 1M events per second, that is 300M events every 5 minutes. 900M every 15, 3.6B every hour.</p>
<p>By using tilt frames we can maximally minimize internal memory consumption, whilst reducing the volume of
incremental computation ( per event, per frame ), and further whilst preserving relative accuracy for
merge-capable aggregate functions.</p>
<p>The converged statistics under merge exhibit the same relative accuracy at a fraction of the computational
and memory overhead without the using the tilt-frame mechanism.</p>
<h2 id="group-mechanics">Group Mechanics<a class="headerlink" href="#group-mechanics" title="Permanent link">&para;</a></h2>
<p>The <code>group by</code> clause in the query language partitions streams before windows and tilt frames
are applied. Groups can be set-based, each-based or composites thereof.</p>
<h3 id="set-based-grouping">Set based grouping<a class="headerlink" href="#set-based-grouping" title="Permanent link">&para;</a></h3>
<p>Grouping by set partitions streams by a concatenation of expressions.</p>
<div class="highlight"><pre><span></span><code><span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"></span>
<span class="nx">group</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">set</span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">country</span><span class="err">,</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">region</span><span class="err">)</span><span class="w"></span>
<span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>In the example expression we are partitioning into a composite group that is
composed of the country and region of each inbound event.</p>
<p>So we expect data of the following form</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span> <span class="nt">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">,</span> <span class="nt">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="nt">&quot;az&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="err">...</span> <span class="p">}</span>
<span class="p">{</span> <span class="nt">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">,</span> <span class="nt">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="nt">&quot;az&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="err">...</span> <span class="p">}</span>
</code></pre></div>
<h3 id="each-based-grouping">Each based grouping<a class="headerlink" href="#each-based-grouping" title="Permanent link">&para;</a></h3>
<p>Given that our data can be nested, however, our data could be structured differently:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">,</span>
  <span class="err">regio</span><span class="kc">ns</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;east&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">],</span>
  <span class="p">}</span>
  <span class="err">...</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nx">select</span><span class="w"> </span><span class="kc">event</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"></span>
<span class="nx">group</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">each</span><span class="err">(</span><span class="nx">record</span><span class="err">::</span><span class="nx">keys</span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">regions</span><span class="err">))</span><span class="w"></span>
<span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>Each field in the nested <code>locations</code> field becomes a component of our
set and qualified by country ...</p>
<h3 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Permanent link">&para;</a></h3>
<p>There are cases however that are currently complex to partition with a
single select statement due to limitations with the grouping clause. For example
what if we wanted to make availability zones a component of our group partitions?</p>
<p>How would we structure such a query?</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;US&quot;</span><span class="p">,</span>
  <span class="err">regio</span><span class="kc">ns</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;east&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">],</span> <span class="err">#</span> <span class="err">AZs</span> <span class="err">by</span> <span class="err">regio</span><span class="kc">n</span>
  <span class="p">}</span>
  <span class="err">...</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nx">create</span><span class="w"> </span><span class="nx">stream</span><span class="w"> </span><span class="nx">by_country_region</span><span class="err">;</span><span class="w"></span>

<span class="nx">select</span><span class="w"> </span><span class="nx">{</span><span class="w"> </span><span class="s">&quot;country&quot;</span><span class="err">:</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">country</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;region&quot;</span><span class="err">:</span><span class="w"> </span><span class="nx">group</span><span class="err">[</span><span class="mi">0</span><span class="err">],</span><span class="w"> </span><span class="s">&quot;azs&quot;</span><span class="err">:</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">regions</span><span class="err">[</span><span class="nx">group</span><span class="err">[</span><span class="mi">0</span><span class="err">]]</span><span class="w"> </span><span class="nx">}</span><span class="w"></span>
<span class="nx">from</span><span class="w"> </span><span class="nx">in</span><span class="w"></span>
<span class="nx">group</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">each</span><span class="err">(</span><span class="nx">record</span><span class="err">::</span><span class="nx">keys</span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">regions</span><span class="err">))</span><span class="w"></span>
<span class="nx">into</span><span class="w"> </span><span class="nx">by_country_region</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>We can preprocess our inbound stream and collapse our locations
sub-record a single level by hoisting the <code>region</code> field to the
top level of a synthetic intermediate outbound stream <code>by_country_region</code>.</p>
<p>We can postprocess the intermediate stream <code>by_country_region</code> into a
single outbound stream that further extracts and hoists the 'az' dimension</p>
<div class="highlight"><pre><span></span><code><span class="nx">select</span><span class="w"> </span><span class="nx">{</span><span class="w"> </span><span class="s">&quot;country&quot;</span><span class="err">:</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">country</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;region&quot;</span><span class="err">:</span><span class="w"> </span><span class="kc">event</span><span class="err">.</span><span class="nx">region</span><span class="err">,</span><span class="w"> </span><span class="s">&quot;az&quot;</span><span class="err">:</span><span class="w"> </span><span class="nx">group</span><span class="err">[</span><span class="mi">0</span><span class="err">],</span><span class="w"> </span><span class="nx">}</span><span class="w"></span>
<span class="nx">from</span><span class="w"> </span><span class="nx">by_country_region</span><span class="w"></span>
<span class="nx">group</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">each</span><span class="err">(</span><span class="kc">event</span><span class="err">.</span><span class="nx">azs</span><span class="err">)</span><span class="w"></span>
<span class="nx">into</span><span class="w"> </span><span class="nx">out</span><span class="err">;</span><span class="w"></span>
</code></pre></div>
<p>So, we need 2 select statements to compose a solution where there are multiple
nesting levels via successive extraction of group components. The same principle
works with more complex grouping requirements.</p>
<p>Once the grouping mechanics are resolved, windowing, aggregation and tilt-frames
can be applied to further refine queries.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../pp/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Lexical Preprocessor
            </div>
          </div>
        </a>
      
      
        <a href="../functions/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Overview
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1609d9a.min.js"></script>
      
    
  </body>
</html>